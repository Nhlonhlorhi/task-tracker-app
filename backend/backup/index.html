{% extends "base.html" %}

{% block title %}Dashboard - Kanban Board{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>My Kanban Board</h2>
    <span class="text-muted">Welcome, {{ username }}</span>
</div>

<!-- Add Task Form -->
<div class="card mb-4">
    <div class="card-body">
        <h5 class="card-title">Add New Task</h5>
        <form method="POST" action="{{ url_for('add') }}">
            <div class="row g-2">
                <div class="col-md-5">
                    <input type="text" class="form-control" name="name" placeholder="Task name" required>
                </div>
                <div class="col-md-4">
                    <select class="form-select" name="day" required>
                        <option value="" disabled selected>Select day</option>
                        <option value="Monday">Monday</option>
                        <option value="Tuesday">Tuesday</option>
                        <option value="Wednesday">Wednesday</option>
                        <option value="Thursday">Thursday</option>
                        <option value="Friday">Friday</option>
                        <option value="Saturday">Saturday</option>
                        <option value="Sunday">Sunday</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <button type="submit" class="btn btn-primary w-100">Add Task</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Kanban Board -->
<div class="row kanban-board">
    <div class="col-md-4">
        <div class="card kanban-column">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">To Do</h5>
            </div>
            <div class="card-body column-todo" data-status="todo">
                {% for task in tasks if task.status == 'todo' %}
                <div class="card mb-2 task-card" data-task-id="{{ task.id }}">
                    <div class="card-body">
                        <h6 class="card-title">{{ task.name }}</h6>
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">{{ task.day }}</small>
                            <div>
                                <a href="{{ url_for('move', task_id=task.id, new_status='inprogress') }}" 
                                   class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-arrow-right"></i>
                                </a>
                                <a href="{{ url_for('delete', task_id=task.id) }}" 
                                   class="btn btn-sm btn-outline-danger"
                                   onclick="return confirm('Are you sure you want to delete this task?')">
                                    <i class="fas fa-trash"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card kanban-column">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">In Progress</h5>
            </div>
            <div class="card-body column-inprogress" data-status="inprogress">
                {% for task in tasks if task.status == 'inprogress' %}
                <div class="card mb-2 task-card" data-task-id="{{ task.id }}">
                    <div class="card-body">
                        <h6 class="card-title">{{ task.name }}</h6>
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">{{ task.day }}</small>
                            <div>
                                <a href="{{ url_for('move', task_id=task.id, new_status='todo') }}" 
                                   class="btn btn-sm btn-outline-secondary">
                                    <i class="fas fa-arrow-left"></i>
                                </a>
                                <a href="{{ url_for('move', task_id=task.id, new_status='done') }}" 
                                   class="btn btn-sm btn-outline-success">
                                    <i class="fas fa-arrow-right"></i>
                                </a>
                                <a href="{{ url_for('delete', task_id=task.id) }}" 
                                   class="btn btn-sm btn-outline-danger"
                                   onclick="return confirm('Are you sure you want to delete this task?')">
                                    <i class="fas fa-trash"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card kanban-column">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">Done</h5>
            </div>
            <div class="card-body column-done" data-status="done">
                {% for task in tasks if task.status == 'done' %}
                <div class="card mb-2 task-card" data-task-id="{{ task.id }}">
                    <div class="card-body">
                        <h6 class="card-title">{{ task.name }}</h6>
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">{{ task.day }}</small>
                            <div>
                                <a href="{{ url_for('move', task_id=task.id, new_status='inprogress') }}" 
                                   class="btn btn-sm btn-outline-warning">
                                    <i class="fas fa-arrow-left"></i>
                                </a>
                                <a href="{{ url_for('delete', task_id=task.id) }}" 
                                   class="btn btn-sm btn-outline-danger"
                                   onclick="return confirm('Are you sure you want to delete this task?')">
                                    <i class="fas fa-trash"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}